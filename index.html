<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒå½¢ç¥ç¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            font-size: 16px;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container-wrapper {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .heart-container {
            position: relative;
            width: 100vmin;
            height: 100vmin;
        }

        .blessing-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .blessing-text {
            position: absolute;
            background: #e19bff;
            padding: 0.625rem 0.9375rem;
            border-radius: 0.5rem;
            box-shadow: 0 0.25rem 0.9375rem rgba(0, 0, 0, 0.2);
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 0.125rem solid #e19bff;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            word-wrap: break-word;
            overflow: hidden;
            z-index: 10;
            opacity: 0;
            transform: scale(0);
        }

        .blessing-text:hover {
            transform: scale(1.05);
            box-shadow: 0 0.375rem 1.25rem rgba(0, 0, 0, 0.3);
            background: #d68aff;
            z-index: 100;
        }

        .music-control {
            position: fixed;
            bottom: 1.25rem;
            right: 1.25rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 3.125rem;
            height: 3.125rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0.125rem 0.625rem rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .music-control:hover {
            background: rgb(255, 255, 255);
            transform: scale(1.1);
        }

        .music-icon {
            font-size: 1.5rem;
            color: #764ba2;
        }

        .music-control.muted .music-icon::before {
            content: "ğŸ”‡";
        }

        .music-control:not(.muted) .music-icon::before {
            content: "ğŸ”Š";
        }

        .play-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            text-align: center;
        }

        .play-button {
            background: #FFB6C1;
            color: #333;
            border: none;
            padding: 0.9375rem 1.875rem;
            font-size: 1.125rem;
            border-radius: 1.875rem;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 0.25rem 0.9375rem rgba(0, 0, 0, 0.2);
        }

        .play-button:hover {
            background: #ffa7b4;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            :root {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            :root {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container-wrapper">
        <div class="heart-container">
            <div class="blessing-container" id="container"></div>
        </div>
    </div>
    
    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-control" id="musicControl">
        <div class="music-icon"></div>
    </div>
    
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="backgroundMusic" loop>
        <source src="è‰¾æ¯”åˆ© - ä¸€ä¸ªäººæƒ³ç€ä¸€ä¸ªäºº(è¯´å”±ç‰ˆ).mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ 
    </audio>
    
    <!-- æ’­æ”¾è¦†ç›–å±‚ -->
    <div class="play-overlay" id="playOverlay">
        <button class="play-button" id="playButton">æ‰“å¼€ç¤¼ç‰©</button>
    </div>
    
    <script>
        // ç¥ç¦è¯­æ•°ç»„
        const blessings = [
            "å¥½å¥½çˆ±è‡ªå·±", "è®°å¾—åƒæ°´æœ", "ä¿æŒå¥½å¿ƒæƒ…", "ä»Šå¤©è¿‡å¾—å¼€å¿ƒ",
            "æ—©ç‚¹ä¼‘æ¯", "åˆ«ç†¬å¤œ", "é¡ºé¡ºåˆ©åˆ©", "æ¢¦æƒ³æˆçœŸ",
            "æˆ‘æƒ³ä½ äº†", "æœŸå¾…ä¸‹ä¸€æ¬¡è§é¢", "æ¯å¤©éƒ½è¦å…ƒæ°”æ»¡æ»¡", "å¥½å¥½åƒé¥­",
            "æ³¨æ„ä¿æš–", "ç‹è€…æ±‚èºº", "åƒé¸¡æœ‰éº¦åˆ«è¸¢", "æ— ç•å¥‘çº¦æ¥roll",
            "ç‹ä½³çªè„‘å­æœ‰ç—…", "å…‰é‡è·‘å›¾", "é‡‘é“²é“²å¼€é“²", "çŒ›å…½æ´¾å¯¹é’“é±¼",
            "æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…", "ä¸€åˆ‡éƒ½ä¼šè¶Šæ¥è¶Šå¥½", "ä¿æŒå¾®ç¬‘", "ä½ æ˜¯æœ€æ£’çš„",
            "ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å“¦", "è®°å¾—å¤šå–æ°´", "ä¿æŒå¥½å¿ƒæ€", "æœªæ¥å¯æœŸ"
        ];

        class HeartBlessing {
            constructor() {
                this.container = document.getElementById('container');
                this.blessingElements = [];
                this.isAnimating = false;
                this.animationId = null;
                this.blessingCount = 0;
                this.currentIndex = 0;
                
                // è®¾å¤‡å°ºå¯¸é…ç½® - ä½¿ç”¨remå•ä½
                this.deviceConfig = {
                    medium: { // 6.3è‹±å¯¸å·¦å³
                        windowCount: 40,
                        windowWidth: 3.625, // rem
                        windowHeight: 2.8125, // rem
                        fontSize: 0.6 // rem
                    },
                    large: { // 6.7è‹±å¯¸åŠä»¥ä¸Š
                        windowCount: 66,
                        windowWidth: 8.25, // rem
                        windowHeight: 4.125, // rem
                        fontSize: 0.9 // rem
                    }
                };
                
                // è·å–å½“å‰è®¾å¤‡ç±»å‹
                this.currentDevice = this.getDeviceType();
                
                // éŸ³ä¹ç›¸å…³
                this.backgroundMusic = document.getElementById('backgroundMusic');
                this.musicControl = document.getElementById('musicControl');
                this.playOverlay = document.getElementById('playOverlay');
                this.playButton = document.getElementById('playButton');
                this.isMusicPlaying = false;
                
                this.init();
            }
            
            getDeviceType() {
                const width = window.innerWidth;
                const height = window.innerHeight;
                const diagonal = Math.sqrt(width * width + height * height) / 96;
                
                if (diagonal <= 6.2) return 'small';
                if (diagonal <= 6.6) return 'medium';
                return 'large';
            }
            
            init() {
                this.setupMusicControl();
                this.attemptAutoPlay();
                
                window.addEventListener('resize', () => {
                    this.blessingElements.forEach(el => el.remove());
                    this.blessingElements = [];
                    
                    this.currentDevice = this.getDeviceType();
                    
                    if (this.isAnimating) {
                        this.stop();
                        setTimeout(() => this.start(), 500);
                    }
                });
            }
            
            setupMusicControl() {
                this.musicControl.addEventListener('click', () => {
                    this.toggleMusic();
                });
                
                this.playButton.addEventListener('click', () => {
                    this.startMusic();
                    this.playOverlay.style.display = 'none';
                    this.startBlessings();
                });
            }
            
            attemptAutoPlay() {
                const playPromise = this.backgroundMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        this.isMusicPlaying = true;
                        this.musicControl.classList.remove('muted');
                        this.playOverlay.style.display = 'none';
                        this.startBlessings();
                    }).catch(error => {
                        console.log("è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’");
                        this.playOverlay.style.display = 'flex';
                    });
                }
            }
            
            startMusic() {
                this.backgroundMusic.play().then(() => {
                    this.isMusicPlaying = true;
                    this.musicControl.classList.remove('muted');
                }).catch(error => {
                    console.log("æ’­æ”¾å¤±è´¥:", error);
                });
            }
            
            toggleMusic() {
                if (this.isMusicPlaying) {
                    this.backgroundMusic.pause();
                    this.musicControl.classList.add('muted');
                } else {
                    this.backgroundMusic.play().catch(e => {
                        console.log("æ’­æ”¾å¤±è´¥:", e);
                    });
                    this.musicControl.classList.remove('muted');
                }
                this.isMusicPlaying = !this.isMusicPlaying;
            }
            
            startBlessings() {
                setTimeout(() => this.start(), 100);
            }
            
            generateHeartPoints() {
                const config = this.deviceConfig[this.currentDevice];
                const points = [];
                
                // å¿ƒå½¢å®¹å™¨å°ºå¯¸
                const containerSize = this.container.offsetWidth;
                
                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ - å¿ƒå½¢å å®¹å™¨çš„90%ï¼Œç¡®ä¿å››å‘¨ç•™ç©ºç›¸åŒ
                const scale = (containerSize * 1) / 35;
                
                // è®¡ç®—ä¸­å¿ƒç‚¹ - ç¨å¾®å‘ä¸Šåç§»ï¼Œé¿å…åº•éƒ¨è¢«é®æŒ¡
                const centerX = containerSize / 2;
                const centerY = containerSize / 2 - containerSize * 0.06; // å‘ä¸Šåç§»2%
                
                for (let i = 0; i < config.windowCount; i++) {
                    const t = 2 * Math.PI * i / config.windowCount;
                    
                    // å¿ƒå½¢æ–¹ç¨‹
                    const x = 16 * Math.pow(Math.sin(t), 3);
                    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
                    
                    const screenX = x * scale + centerX;
                    const screenY = -y * scale + centerY;
                    
                    points.push({ x: screenX, y: screenY });
                }
                return points;
            }
            
            createBlessingElement(blessing, x, y) {
                const config = this.deviceConfig[this.currentDevice];
                const element = document.createElement('div');
                element.className = 'blessing-text';
                element.textContent = blessing;
                
                // è®¾ç½®çª—å£å¤§å°å’Œå­—ä½“
                element.style.width = `${config.windowWidth}rem`;
                element.style.height = `${config.windowHeight}rem`;
                element.style.fontSize = `${config.fontSize}rem`;
                
                // è®¡ç®—ä½ç½®ï¼Œä½¿å…ƒç´ ä¸­å¿ƒå¯¹å‡†åæ ‡ç‚¹
                const remToPx = parseFloat(getComputedStyle(document.documentElement).fontSize);
                const elementWidthPx = config.windowWidth * remToPx;
                const elementHeightPx = config.windowHeight * remToPx;
                
                element.style.left = `${x - elementWidthPx/2}px`;
                element.style.top = `${y - elementHeightPx/2}px`;
                
                // æ·»åŠ å…³é—­åŠŸèƒ½
                element.addEventListener('click', () => {
                    element.style.transform = 'scale(0)';
                    element.style.opacity = '0';
                    setTimeout(() => {
                        element.remove();
                        this.blessingElements = this.blessingElements.filter(el => el !== element);
                    }, 300);
                });
                
                this.container.appendChild(element);
                
                // æ·»åŠ å‡ºç°åŠ¨ç”»
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.opacity = '0.9';
                }, 10);
                
                return element;
            }
            
            start() {
                if (this.isAnimating) return;
                
                this.isAnimating = true;
                this.currentIndex = 0;
                const points = this.generateHeartPoints();
                
                const addBlessing = () => {
                    if (!this.isAnimating || this.currentIndex >= points.length) {
                        this.stop();
                        return;
                    }
                    
                    const point = points[this.currentIndex];
                    const blessing = blessings[Math.floor(Math.random() * blessings.length)];
                    const element = this.createBlessingElement(blessing, point.x, point.y);
                    
                    this.blessingElements.push(element);
                    this.blessingCount++;
                    
                    this.currentIndex++;
                    
                    // åˆ›å»ºé€Ÿåº¦
                    setTimeout(() => {
                        if (this.isAnimating) {
                            this.animationId = requestAnimationFrame(addBlessing);
                        }
                    }, 150);
                };
                
                this.animationId = requestAnimationFrame(addBlessing);
            }
            
            stop() {
                this.isAnimating = false;
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåç«‹å³åˆå§‹åŒ–
        window.addEventListener('load', () => {
            new HeartBlessing();
        });
    </script>
</body>
</html>
